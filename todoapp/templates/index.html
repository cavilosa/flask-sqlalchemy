<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Todo App</title>
    </head>
    <style media="screen">
        .hidden {
            display: none;
        }
    </style>
    <body>

        <div id="error" class="hidden">
            Something went wrong!
        </div>

        <form id="form">
            <div >
                <label for="todo">Create a To-Do</label>
                <input type="text" id="description" name="description">
            </div>
            <div>
                <input type="submit" name="submit" id="submit" value="Create">
            </div>
        </form>

        <ul id="todos">
            {% for d in data %}
            <li>{{ d.description }}</li>
            {% endfor %}
        </ul>

    <script type="text/javascript">
        document.querySelector("#form").onsubmit = function(e) {
           e.preventDefault();
           const description = document.querySelector("#description").value;
           fetch("/todos/create", {
               method: "POST",
               body: JSON.stringify(
                   {"description": description}
               ),
               headers: {
                   "Content-Type": "application/json"
               }
           })
           .then( (response) => {
                return response.json();
           })
           .then( (jsonResponse) => {
               console.log("jsonresponse", jsonResponse);
               const liItem = document.createElement("LI");
               liItem.innerHTML = jsonResponse["description"];
               document.querySelector("#todos").appendChild(liItem);
           })
           .catch( (error)=> {
                console.log(error)
                document.querySelector("#error").className = "";
           })
        }
    </script>
    </body>
</html>
